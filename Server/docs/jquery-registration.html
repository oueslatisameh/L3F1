<!DOCTYPE html>

<html>
<head>
  <title>jquery-registration.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Chart.min.html">
                Chart.min.js
              </a>
            
              
              <a class="source" href="bootstrap-sidebar.html">
                bootstrap-sidebar.js
              </a>
            
              
              <a class="source" href="bootstrap.html">
                bootstrap.js
              </a>
            
              
              <a class="source" href="bootstrap.min.html">
                bootstrap.min.js
              </a>
            
              
              <a class="source" href="holder.html">
                holder.js
              </a>
            
              
              <a class="source" href="jquery-1.3.2.min.html">
                jquery-1.3.2.min.js
              </a>
            
              
              <a class="source" href="jquery-account.html">
                jquery-account.js
              </a>
            
              
              <a class="source" href="jquery-admin.html">
                jquery-admin.js
              </a>
            
              
              <a class="source" href="jquery-barcode.html">
                jquery-barcode.js
              </a>
            
              
              <a class="source" href="jquery-card.html">
                jquery-card.js
              </a>
            
              
              <a class="source" href="jquery-faddress.html">
                jquery-faddress.js
              </a>
            
              
              <a class="source" href="jquery-list.html">
                jquery-list.js
              </a>
            
              
              <a class="source" href="jquery-lookingforproduct.html">
                jquery-lookingforproduct.js
              </a>
            
              
              <a class="source" href="jquery-map.html">
                jquery-map.js
              </a>
            
              
              <a class="source" href="jquery-product.html">
                jquery-product.js
              </a>
            
              
              <a class="source" href="jquery-registration.html">
                jquery-registration.js
              </a>
            
              
              <a class="source" href="jquery.min.html">
                jquery.min.js
              </a>
            
              
              <a class="source" href="sha1.html">
                sha1.js
              </a>
            
              
              <a class="source" href="validator.min.html">
                validator.min.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery-registration.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <table border="1">
<tr>
    <th>contenu dans la page </th> <th><b>registration.jade</b></th>
</tr>
</table>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Déclaration de tableau</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> nuance = {<span class="hljs-comment">// tableau des champs d'un champ avec sa fonction de format et si le champ est clé primaire dans postgreSQL ou non</span>
	email : {val :validator.isEmail, ne : <span class="hljs-literal">true</span>, name : <span class="hljs-string">"Addresse Email"</span>},
	password : {val : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span><span class="hljs-keyword">return</span>(<span class="hljs-literal">true</span>);}, ne : <span class="hljs-literal">true</span>, name : <span class="hljs-string">"Mot de passe"</span>},
	cpassword : {val : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span><span class="hljs-keyword">return</span>(<span class="hljs-literal">true</span>);}, ne : <span class="hljs-literal">true</span>, name : <span class="hljs-string">"Confirmation"</span>},
	name : {val : validator.isAlpha, ne : <span class="hljs-literal">true</span>, name : <span class="hljs-string">"Nom"</span>},
	forename : {val : validator.isAlpha, ne : <span class="hljs-literal">true</span>, name : <span class="hljs-string">"Prenom"</span>},
	birth : {val : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(input)</span> {</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[0-9]{2}[\/-][0-9]{2}[\/-][0-9]{4}/</span>.test(input)) {
			<span class="hljs-keyword">return</span>(<span class="hljs-literal">true</span>);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[0-9]{4}-[0-9]{2}-[0-9]{2}/</span>.test(input)) {
			<span class="hljs-keyword">return</span>(<span class="hljs-literal">true</span>);
		}
		<span class="hljs-keyword">return</span> (<span class="hljs-literal">false</span>);
	}, ne : <span class="hljs-literal">false</span>, name : <span class="hljs-string">"Date de Naissance"</span>},
	address : {val : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(input)</span> {</span>
			input = input.replace(<span class="hljs-regexp">/[, áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ-]/g</span>, <span class="hljs-string">""</span>);
			alert(input);
			<span class="hljs-keyword">return</span> (validator.isAlphanumeric(input));
		}, ne : <span class="hljs-literal">false</span>, name : <span class="hljs-string">"Adresse"</span>},
	postcode : {val : validator.isNumeric, ne : <span class="hljs-literal">false</span>, name : <span class="hljs-string">"Code postal"</span>},
	town : {val : validator.isAlpha, ne : <span class="hljs-literal">false</span>, name : <span class="hljs-string">"Ville"</span>}
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><b>verify</b> : lorsque l’utilisateur souhaite soumettre le formule d’inscription, les champs sont vérifiés,
modifiés dans le cas de la date de naissance pour correspondre au format de postrgeSQL et supprimés si
les fonctions de validation retournent false. Lorsque les champs obligatoires ont été entré et que
le format des autres sont correct, une requête AJAX est faite au serveur avec les valeurs des champs<br />
<small>fais appel à la route DELETE <a href="registration.html"><b>/email</b></a></small></p>
<ul>
<li>paramètre</li>
<ul>
    <li><b>name</b> : nom de la marque</li>
    <li><b>i</b> : indice de la carte</li>
</ul>
<li>sortie</li>
<ul>
    <li><b>success</b> : rechargement de la page</li>
    <li><b>failure</b> : indication à l’utilisateur que la carte n’existe pas</li>
</ul>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">var</span> fault = <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">var</span> err = [];
	<span class="hljs-keyword">var</span> help;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> nuance) { <span class="hljs-comment">// vérification des champs avec le tableau nuance</span>
		help = $(<span class="hljs-string">"input[name='"</span> + i + <span class="hljs-string">"']"</span>);
		<span class="hljs-keyword">if</span> (nuance[i].ne &amp;&amp; help.val() === <span class="hljs-string">""</span>) {
			fault = <span class="hljs-literal">true</span>;
			help.val(<span class="hljs-string">""</span>);
			err.push(nuance[i].name + <span class="hljs-string">" n'a pas ete entre(e)"</span>);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (help.val() !== <span class="hljs-string">""</span> &amp;&amp; !nuance[i].val(help.val())) {
			fault = <span class="hljs-literal">true</span>;
			err.push(nuance[i].name + <span class="hljs-string">" contient des caracteres illegaux"</span>);
			help.val(<span class="hljs-string">""</span>);
		}
	}
	<span class="hljs-keyword">if</span> ($(<span class="hljs-string">"input[name='password']"</span>).val() != $(<span class="hljs-string">"input[name='cpassword']"</span>).val()) { <span class="hljs-comment">// si les deux mot de passe sont différent</span>
		fault = <span class="hljs-literal">true</span>;
		err.push(<span class="hljs-string">"Les mots de passe sont differents"</span>);
		$(<span class="hljs-string">"input[name='cpassword']"</span>).val(<span class="hljs-string">""</span>);
	}
	help = $(<span class="hljs-string">"input[name='birth']"</span>);
	<span class="hljs-keyword">if</span> (help.val() !== <span class="hljs-string">""</span> &amp;&amp; <span class="hljs-regexp">/[0-9]{2}[\/-][0-9]{2}[\/-][0-9]{4}/</span>.test(help.val())) { <span class="hljs-comment">// formatage de la date de naissance</span>
		<span class="hljs-keyword">var</span> tab;
		tab = help.val().split((help.val().indexOf(<span class="hljs-string">'/'</span>) == -<span class="hljs-number">1</span>) ? <span class="hljs-string">"-"</span> : <span class="hljs-string">"/"</span>);	
		help.val(tab[<span class="hljs-number">2</span>] + <span class="hljs-string">"-"</span> + tab[<span class="hljs-number">1</span>] + <span class="hljs-string">"-"</span> + tab[<span class="hljs-number">0</span>]);
	}
	<span class="hljs-keyword">if</span> (fault) { <span class="hljs-comment">// en cas d'erreur</span>
		$(<span class="hljs-string">"div#jumb"</span>).prepend( <span class="hljs-comment">// ajout d'un message d'erreur dans la page web avec des indications</span>
				$(<span class="hljs-string">"&lt;div class=\"alert alert-warning alert-dismissable\"&gt;&lt;/div&gt;"</span>).html((<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					<span class="hljs-keyword">var</span> result = <span class="hljs-string">""</span>;
					<span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; err.length; y++) {
						result += err[y] + <span class="hljs-string">"&lt;br /&gt;"</span>;
					}
					<span class="hljs-keyword">return</span> (result);
				})()).prepend(
						$(<span class="hljs-string">"&lt;button type=\"button\" data-dismiss=\"alert\" aria-hidden=\"true\" class=\"close\"&gt;&lt;/button&gt;"</span>)
						.html(<span class="hljs-string">"&amp;times;"</span>)
				)
		);
		$(<span class="hljs-string">'html, body'</span>).animate({ scrollTop: <span class="hljs-number">0</span> }, <span class="hljs-string">'slow'</span>); <span class="hljs-comment">// positionne le navigateur en haut de page</span>
	} <span class="hljs-keyword">else</span> {
		$.ajax({ <span class="hljs-comment">// requête AJAX au serveur</span>
			url : <span class="hljs-string">'/email/'</span>,
			type : <span class="hljs-string">'GET'</span>,
			dataType : <span class="hljs-string">"json"</span>,
			data : <span class="hljs-string">'email='</span> + $(<span class="hljs-string">"input[name='email']"</span>).val(), <span class="hljs-comment">// vérification de la disponibilité de l'adresse email</span>
			complete : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(xhr, result)</span> {</span>
				json = <span class="hljs-built_in">JSON</span>.parse(xhr.responseText);
				<span class="hljs-keyword">if</span> (result == <span class="hljs-string">'success'</span> &amp;&amp; json.registered == <span class="hljs-string">'success'</span>) { <span class="hljs-comment">// si oui alors hashage du mot de passe</span>
					$(<span class="hljs-string">"input[name='password']"</span>).val(CryptoJS.SHA1($(<span class="hljs-string">"input[name='password']"</span>).val()));
					$(<span class="hljs-string">"input[name='cpassword']"</span>).val(CryptoJS.SHA1($(<span class="hljs-string">"input[name='cpassword']"</span>).val()));
					$(<span class="hljs-string">"form#forr"</span>).submit(); <span class="hljs-comment">// envoie des informations</span>
				} <span class="hljs-keyword">else</span> { <span class="hljs-comment">// sinon</span>
					$(<span class="hljs-string">"input[name='email']"</span>).val(<span class="hljs-string">""</span>);
					$(<span class="hljs-string">"div#jumb"</span>).prepend(<span class="hljs-comment">// ajout d'un message d'erreur dans la page web avec une indication</span>
						$(<span class="hljs-string">"&lt;div class=\"alert alert-warning alert-dismissable\"&gt;&lt;/div&gt;"</span>)
							.html(<span class="hljs-string">"l'adresse email existe deja"</span>)
							.prepend(
								$(<span class="hljs-string">"&lt;button type=\"button\" data-dismiss=\"alert\" aria-hidden=\"true\" class=\"close\"&gt;&lt;/button&gt;"</span>)
									.html(<span class="hljs-string">"&amp;times;"</span>)
							)
					);
					$(<span class="hljs-string">'html, body'</span>).animate({ scrollTop: <span class="hljs-number">0</span> }, <span class="hljs-string">'slow'</span>);  <span class="hljs-comment">// positionne le navigateur en haut de page</span>
				}
			}
		});
	}
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><b>reset</b> : supprime le contenu de tout les champs. lancé lorsque l’utilisateur appui sur rafraîchir</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> nuance) {
		help = $(<span class="hljs-string">"input[name='"</span> + i + <span class="hljs-string">"']"</span>);
		help.val(<span class="hljs-string">""</span>);
	}
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
